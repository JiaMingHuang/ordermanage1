<div class="panel-body">
	<div class="page-header part_header">
		<h1>
			<small>订单主信息</small>
		</h1>
	</div>
<form id="order-add-form">
	<div class="form-group" style="padding-left: 15px; padding-right: 15px">
		<label>订单类型：</label> 
		<input class="radio_btn" type="radio" name="ordertype" value="1" checked/>工厂订单
		<input class="radio_btn" type="radio" name="ordertype" value="2"/>电镀厂订单
	</div>
	<div class="form-group">
		<div class="col-xs-6">
			<label>订单编号：</label> <input class="form-control" name="ordernumber"/>
		</div>
		<div class="col-xs-6">
			<label>客户名称：</label> <input class="form-control" name="clientname"/>
		</div>
		<div class="col-xs-6">
			<label>客户要求发货时间：</label> <input class="form-control" name="clientdeliverytime" type="date"/>
		</div>
		<div class="col-xs-6">
			<label>工厂交货时间：</label> <input class="form-control" name="factorydeliverytime" type="date"/>
		</div>
		<div class="col-xs-6">
			<label>客户联系电话：</label> <input class="form-control" name="contact"/>
		</div>
		<div class="col-xs-6">
			<label>送货地址：</label> <input class="form-control" name="address"/>
		</div>
		<div class="col-xs-6">
			<label>退货重镀原因：</label> <input class="form-control" name="reason"/>
		</div>
	</div>

</form>
</div>

<div class="panel-body">
	<div class="order_table table-responsive">
		<div class="page-header part_header">
			<h1>
				<small>商品详情批量导入</small>
			</h1>
		</div>
		<!--<form id="batchimport" th:method="post" th:action="@{/order/batchImport}" enctype="multipart/form-data">-->
		<div class="panel-body">
			<input class="btn btn-primary" type="file" name="uploadFile" id="uploadFile">
			<div>
				<p class="fa fa-folder" style="margin-top: 10px"><a href="/order/getTemplate">下载模板 :
					佰丽水晶订单商品种类导入模板</a>
				</p></div>
			<div>导入文件仅允许导入“xls”或“xlsx”格式文件！</div>
		</div>
		<!--</form>-->
		<div class="save_btn_container">
			<button type="button" class="btn btn-primary" onclick="batchImport();">保存</button>
		</div>
	</div>
</div>

<style type="text/css">
.form-control {
	width: 80%
}

</style>
<script>

    function batchImport() {
        if ($("#uploadFile").val() == '') {
            alert("请先选择商品详情表再进行保存操作！");
        } else {
            var orderVO = $("#order-add-form").serializeObject();// 序列化表单内容
            var orderModel = {
                orderVO: orderVO
            };
            $.ajax({
                type: "POST",
                url: "/order/form",
                data: JSON.stringify(orderModel),
                dataType: "json",
                async: false,
                contentType: "application/json",
                context: document.body,
                success: function (data) {
                    if (data.FLAG == true) {
                        //订单主信息保存成功，则开始导入excel
                        importExp(data.ORDERID);
                    }

                },
                error: function (data) {
                    // 提示新增失败
                }
            });
        }
    }

    function importExp(orderId) {
        var formData = new FormData();
        var name = $("#uploadFile").val();
        formData.append("file", $("#uploadFile")[0].files[0]);
        formData.append("name", name);
        $.ajax({
            type: "POST",
            url: `/order/batchImport/${orderId}`,
            data: formData,
            dataType: "json",
            async: false,
            processData: false,
            contentType: false,
            context: document.body,
            beforeSend: function () {
                console.log("正在进行，请稍候");
            },
            success: function (data) {
                if (data.flag == false) {
                    alert(data.msg);
                } else {
                    alert(data.msg);
                    $("#myModal").click();
                    initData();
                }
            },
            error: function (data) {
                // 提示新增失败
            }
        });
    }
</script>